# UserParameter checks for FhGFS

# fhgfs.list_unreachable
#
# Arguments:
#   None
#
# Returns:
#   If servers are unreachable, returns a comma delimited list of their nodeIDs 
#
UserParameter=fhgfs.list_unreachable,fhgfs-check-servers | grep UNREACHABLE | sed -r -e 's/^(.*)\s+\[.*\]:\s+UNREACHABLE/\1/g' | paste -sd ","

<% ['management','metadata','storage','client'].each do |type| -%>
# fhgfs.<%= type %>.reachable
#
# Arguments:
#   1 - nodeID
#
# Returns:
#   1 - reachable
#   0 - unreachable
#
UserParameter=fhgfs.<%= type %>.reachable[*],fhgfs-ctl --listnodes --reachable --nodetype=<%= type %> | grep -A1 '^$1\s\[' | grep -c "Reachable: <yes>"

<% end -%>

# fhgfs.pool.status
#
# Arguments:
#   1 - nodeNumID
#   2 - nodeType
#
# Returns:
#   pool status string of "normal", "low", or "emergency"
#
UserParameter=fhgfs.pool.status[*],<%= @scripts_dir %>/fhgfs-pool-status.py $1 $2

# fhgfs.client.num
#
# Arguments:
#   None
#
# Returns:
#  Number of registered FhGFS clients
#
UserParameter=fhgfs.client.num,fhgfs-ctl --listnodes --nodetype=client | wc -l